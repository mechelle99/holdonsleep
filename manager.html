<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>ä¸»ç®¡å°ˆå€</title>
  <style>
    /* å¼•ç”¨ root è®Šæ•¸ */
    :root { --primary: #2563eb; --bg: #f3f4f6; --surface: #ffffff; --text: #1f2937; }
    body { font-family: -apple-system, sans-serif; background: var(--bg); padding: 20px 20px 100px 20px; color: var(--text); }
    
    .header { margin-bottom: 20px; }
    h2 { margin: 0; font-size: 24px; }
    h3 { margin-top: 30px; margin-bottom: 15px; border-left: 4px solid var(--primary); padding-left: 10px; }

    /* çµ±è¨ˆå¡ç‰‡ */
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 12px; }
    .stat-card { background: var(--surface); padding: 16px; border-radius: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); text-align: center; }
    .stat-name { font-weight: 700; margin-bottom: 8px; font-size: 16px; }
    .stat-row { font-size: 13px; color: #6b7280; display: flex; justify-content: space-between; margin-top: 4px; }
    .stat-val { font-weight: 700; color: var(--primary); }

    /* å¾…å¯©åˆ—è¡¨ */
    .req-card { background: var(--surface); padding: 16px; border-radius: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; }
    .req-info div { margin-bottom: 4px; font-size: 14px; }
    .req-tag { background: #e5e7eb; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: 600; }
    
    .btn-action { padding: 8px 16px; border-radius: 8px; border: none; color: white; font-weight: 600; cursor: pointer; margin-left: 5px; }
    .btn-approve { background: #10b981; }
    .btn-reject { background: #ef4444; }
    .btn-all { background: var(--primary); color: white; border: none; padding: 4px 10px; border-radius: 6px; font-size: 12px; float: right; cursor: pointer; }

    /* åº•éƒ¨å°èˆª (åŒä¸Š) */
    .bottom-nav { position: fixed; bottom: 20px; left: 20px; right: 20px; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border-radius: 24px; padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); z-index: 100; border: 1px solid rgba(255,255,255,0.5); }
    .nav-item { display: flex; flex-direction: column; align-items: center; gap: 4px; color: #9ca3af; text-decoration: none; font-size: 10px; font-weight: 600; }
    .nav-item.active { color: var(--primary); }
    .nav-icon { font-size: 20px; }
  </style>
</head>
<body>

<div class="header"><h2>ğŸ‘¨â€ğŸ’¼ ä¸»ç®¡å°ˆå€</h2></div>

<h3>ğŸ“Š åœ˜éšŠé¤˜é¡æ¦‚æ³</h3>
<div id="teamStats" class="stats-grid">è¼‰å…¥ä¸­...</div>

<h3>
  ğŸ“ å¾…å¯©æ ¸ç”³è«‹
  <button class="btn-all" onclick="approveAll()">ä¸€éµå…¨å‡†</button>
</h3>
<div id="pendingList">è¼‰å…¥ä¸­...</div>

<nav class="bottom-nav">
  <a href="app.html" class="nav-item"><span class="nav-icon">ğŸ </span><span>é¦–é </span></a>
  <a href="request.html" class="nav-item"><span class="nav-icon">ğŸ“</span><span>ç”³è«‹</span></a>
  <a href="history.html" class="nav-item"><span class="nav-icon">ğŸ“‹</span><span>ç´€éŒ„</span></a>
  <a href="schedule.html" class="nav-item"><span class="nav-icon">ğŸ“…</span><span>æ’ç­</span></a>
  <a href="manager.html" class="nav-item active"><span class="nav-icon">ğŸ‘‘</span><span>ä¸»ç®¡</span></a>
</nav>

<script src="config.js"></script>
<script>
  const uid = localStorage.getItem("employeeId");

  function api(act, d={}) {
    return new Promise(r => {
      const s = document.createElement("script");
      s.src = `${window.CONFIG.GAS_ENDPOINT}?action=${act}&payload=${encodeURIComponent(JSON.stringify({...d, userId:uid}))}&callback=cb${Date.now()}`;
      window[`cb${Date.now()}`] = (res) => { r(res); s.remove(); };
      document.body.appendChild(s);
    });
  }

  async function load() {
    // çµ±è¨ˆ
    const stats = await api("get_team_stats");
    const sDiv = document.getElementById("teamStats");
    if(stats.ok) {
        let h = "";
        stats.list.forEach(d => {
            h += `<div class="stat-card">
              <div class="stat-name">${d.name||'ID:'+d.id}</div>
              <div class="stat-row"><span>ç‰¹ä¼‘</span><span class="stat-val">${d.annual}</span></div>
              <div class="stat-row"><span>è£œä¼‘</span><span class="stat-val">${d.comp}</span></div>
            </div>`;
        });
        sDiv.innerHTML = h;
    }

    // å¾…å¯©
    const pend = await api("get_pending");
    const pDiv = document.getElementById("pendingList");
    if(pend.ok && pend.list.length > 0) {
        let h = "";
        pend.list.forEach(r => {
            let type = r.leaveType;
            if(r.category==='CORRECTION') type="è£œå¡";
            if(r.category==='OT') type="åŠ ç­";
            
            h += `<div class="req-card" id="c-${r.reqId}">
              <div class="req-info">
                <div style="font-weight:700">${r.reqId} <span class="req-tag">${type}</span></div>
                <div>${r.start.split('T')[0]} ${r.category!=='CORRECTION'?'('+r.hours+'h)':''}</div>
                <div style="color:#666;font-size:12px">${r.reason||'ç„¡äº‹ç”±'}</div>
              </div>
              <div>
                <button class="btn-action btn-approve" onclick="review('${r.reqId}','APPROVED')">å‡†</button>
                <button class="btn-action btn-reject" onclick="review('${r.reqId}','REJECTED')">é§</button>
              </div>
            </div>`;
        });
        pDiv.innerHTML = h;
    } else {
        pDiv.innerHTML = "<div style='text-align:center;color:#999;padding:20px'>ç„¡å¾…å¯©æ ¸é …ç›®</div>";
    }
  }

  async function review(rid, dec) {
      if(!confirm("ç¢ºå®šå—ï¼Ÿ")) return;
      await api("review_request", {reqId:rid, decision:dec});
      document.getElementById(`c-${rid}`).remove();
  }

  async function approveAll() {
      if(!confirm("ç¢ºå®šå…¨éƒ¨æ ¸å‡†ï¼Ÿ")) return;
      const now = new Date();
      await api("approve_month_all", {year:now.getFullYear(), month:now.getMonth()+1});
      alert("å®Œæˆ"); location.reload();
  }

  load();
</script>
</body>
</html>
