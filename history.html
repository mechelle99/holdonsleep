<!DOCTYPE html>
<html>
<head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<style>
  body{font-family:sans-serif;padding:16px;background:#f4f6f8;}
  .card{background:#fff;padding:16px;border-radius:12px;margin-bottom:10px;}
  .st{float:right;font-size:12px;padding:2px 6px;border-radius:4px;}
  .ok{background:#d4edda;color:#155724;} .wait{background:#fff3cd;color:#856404;}
</style>
</head>
<body>
  <h3>ğŸ“œ æ­·å²ç´€éŒ„</h3>
  <div style="margin-bottom:10px;">
    <select id="y"></select><select id="m"></select>
    <button onclick="load()">æŸ¥è©¢</button>
    <button onclick="location.href='app.html'">è¿”å›</button>
  </div>
  <div id="list"></div>
  <script src="config.js"></script>
  <script>
    const uid=localStorage.getItem("employeeId");
    const now=new Date();
    // init select
    const yS=document.getElementById("y"), mS=document.getElementById("m");
    for(let i=now.getFullYear();i>=2024;i--) yS.add(new Option(i,i));
    for(let i=1;i<=12;i++) mS.add(new Option(i,i,i===(now.getMonth()+1),i===(now.getMonth()+1)));

    function api(a,d){ /* åŒä¸Šï¼Œçœç•¥é‡è¤‡å¯«æ³• */ 
      return new Promise(r=>{
        const cb="c"+Date.now();
        const s=document.createElement("script");
        s.src=`${window.CONFIG.GAS_ENDPOINT}?action=${a}&payload=${encodeURIComponent(JSON.stringify({...d,userId:uid}))}&callback=${cb}`;
        window[cb]=res=>{r(res);s.remove()};
        document.body.appendChild(s);
      });
    }

    async function load(){
      document.getElementById("list").innerHTML = "è¼‰å…¥ä¸­...";
      const res = await api("get_dashboard", {year:yS.value, month:mS.value});
      let h = "";
      if(res.ok && res.list) {
        res.list.forEach(r => {
          const cls = r.status==='é€šé'?'ok':'wait';
          h += `<div class="card">
            <span class="st ${cls}">${r.status}</span>
            <b>${r.title}</b><br>
            <small>${r.date} ${r.time}</small>
          </div>`;
        });
      }
      document.getElementById("list").innerHTML = h || "ç„¡è³‡æ–™";
    }
    load();
  </script>
</body>
</html>
