<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>æ­·å²ç´€éŒ„</title>
  <style>
    body{font-family:-apple-system,sans-serif;background:#f4f6f8;margin:0;padding:20px;color:#333;}
    .container{max-width:800px;margin:0 auto;}
    .btn-back{display:inline-block;padding:8px 16px;background:#333;color:#fff;text-decoration:none;border-radius:6px;margin-bottom:20px;}
    .card{background:#fff;border-radius:12px;padding:20px;box-shadow:0 4px 12px rgba(0,0,0,0.05);}
    .hist-item {border-bottom:1px solid #eee;padding:12px 0;}
    .hist-status {font-size:12px;padding:2px 6px;border-radius:4px;float:right;font-weight:bold;}
    .st-PENDING { background:#fff3e0; color:#ff9800; }
    .st-APPROVED { background:#e8f5e9; color:#28a745; }
    .st-REJECTED { background:#ffebee; color:#c62828; }
  </style>
</head>
<body>
<div class="container">
  <a href="app.html" class="btn-back">â† å›é¦–é </a>
  <div class="card">
    <h3 style="margin-top:0;">ğŸ“œ ç”³è«‹ç´€éŒ„</h3>
    <div id="listArea">è¼‰å…¥ä¸­...</div>
  </div>
</div>
<script src="config.js"></script>
<script>
  const userId = localStorage.getItem("employeeId");
  if(!userId) location.href="index.html";

  function api(act) {
    return new Promise((resolve, reject)=>{
      const cb = "cb"+Date.now();
      const payload = JSON.stringify({ userId, webhookKey: window.CONFIG?.WEBHOOK_KEY });
      const s = document.createElement("script");
      s.src = `${window.CONFIG.GAS_ENDPOINT}?action=${act}&payload=${encodeURIComponent(payload)}&callback=${cb}`;
      window[cb] = (res) => { resolve(res); document.body.removeChild(s); };
      document.body.appendChild(s);
    });
  }

  async function loadData(){
    try {
      const res = await api("list_requests");
      const div = document.getElementById("listArea");
      if (res.ok && res.list && res.list.length > 0) {
        div.innerHTML = "";
        res.list.forEach(r => {
          const stMap = { 'PENDING':'å¯©æ ¸ä¸­', 'APPROVED':'é€šé', 'REJECTED':'é§å›' };
          const timeStr = r.start.substring(5,16).replace('T',' ') + ' ~ ' + r.end.substring(5,16).replace('T',' ');
          div.innerHTML += `
            <div class="hist-item">
              <span class="hist-status st-${r.status}">${stMap[r.status]||r.status}</span>
              <div style="font-weight:bold;">${r.category} ${r.leaveType||''}</div>
              <div style="color:#666;font-size:13px;margin-top:4px;">${timeStr}</div>
              <div style="color:#888;font-size:12px;">${r.reason||''}</div>
            </div>
          `;
        });
      } else {
        div.innerHTML = "<div style='text-align:center;color:#999;'>ç„¡ç´€éŒ„</div>";
      }
    } catch(e) { document.getElementById("listArea").innerHTML = "è¼‰å…¥å¤±æ•—"; }
  }
  loadData();
</script>
</body>
</html>
